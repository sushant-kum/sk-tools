<section class="app-auth__create-account mat-app-background">
  <mat-card class="app-auth__create-account__card mat-elevation-z0">
    <mat-card-header class="app-auth__create-account__card__header">
      <img class="app-auth__create-account__card__header__logo" src="assets/images/logo-full.min.png" alt="SK Tools" />
      <h1 class="app-auth__create-account__card__header__title">
        Create account
      </h1>
    </mat-card-header>

    <mat-card-content class="app-auth__create-account__card__content">
      <form [formGroup]="form_create_account" class="app-auth__create-account__card__content__form">
        <mat-form-field appearance="standard" class="app-auth__create-account__card__content__form__input--first-name">
          <fa-icon
            [icon]="['fas', 'user']"
            matPrefix
            class="app-auth__create-account__card__content__form__input__prefix"
            [ngClass]="{
              'app-text-theme-primary':
                !form_create_account.get('first_name').touched || form_create_account.get('first_name').valid,
              'app-text-theme-warn':
                form_create_account.get('first_name').touched && form_create_account.get('first_name').invalid
            }"
          ></fa-icon>
          <mat-label>First name</mat-label>
          <input matInput formControlName="first_name" />
          <mat-error *ngIf="form_create_account.get('first_name').hasError('required')"
            ><fa-icon [icon]="['fas', 'exclamation-circle']"></fa-icon> First name is required</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="standard" class="app-auth__create-account__card__content__form__input--last-name">
          <fa-icon
            [icon]="['fas', 'user']"
            matPrefix
            class="app-auth__create-account__card__content__form__input__prefix"
            [ngClass]="{
              'app-text-theme-primary':
                !form_create_account.get('last_name').touched || form_create_account.get('last_name').valid,
              'app-text-theme-warn':
                form_create_account.get('last_name').touched && form_create_account.get('last_name').invalid
            }"
          ></fa-icon>
          <mat-label>Last name</mat-label>
          <input matInput formControlName="last_name" />
          <mat-error *ngIf="form_create_account.get('last_name').hasError('required')"
            ><fa-icon [icon]="['fas', 'exclamation-circle']"></fa-icon> Last name is required</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="standard" class="app-auth__create-account__card__content__form__input--email">
          <fa-icon
            [icon]="['fas', 'at']"
            matPrefix
            class="app-auth__create-account__card__content__form__input__prefix"
            [ngClass]="{
              'app-text-theme-primary':
                !form_create_account.get('email').touched || form_create_account.get('email').valid,
              'app-text-theme-warn':
                form_create_account.get('email').touched && form_create_account.get('email').invalid
            }"
          ></fa-icon>
          <mat-label>E-mail</mat-label>
          <input matInput formControlName="email" />
          <mat-error *ngIf="form_create_account.get('email').hasError('required')"
            ><fa-icon [icon]="['fas', 'exclamation-circle']"></fa-icon> E-mail is required</mat-error
          >
          <mat-error *ngIf="form_create_account.get('email').hasError('email')"
            ><fa-icon [icon]="['fas', 'exclamation-circle']"></fa-icon> This should be a valid e-mail address</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="standard" class="app-auth__create-account__card__content__form__input--country">
          <fa-icon
            [icon]="['fas', 'flag']"
            matPrefix
            class="app-auth__create-account__card__content__form__input__prefix"
            [ngClass]="{
              'app-text-theme-primary':
                !form_create_account.get('country').touched || form_create_account.get('country').valid,
              'app-text-theme-warn':
                form_create_account.get('country').touched && form_create_account.get('country').invalid
            }"
          ></fa-icon>
          <mat-label>Country</mat-label>
          <input matInput formControlName="country" [matAutocomplete]="autoCountry" />
          <mat-autocomplete autoActiveFirstOption #autoCountry="matAutocomplete" [displayWith]="displayWithCountry">
            <mat-option
              class="app-auth__create-account__card__content__form__input--country__country-option"
              *ngFor="let country of filtered_countries | async"
              [value]="country"
              [matTooltip]="country.name + ' | +' + country.phone + ' | ' + country.native"
            >
              <img
                class="app-auth__create-account__card__content__form__input--country__country-option__flag"
                aria-hidden
                [src]="country.flag"
              />
              <span class="app-auth__create-account__card__content__form__input--country__country-option__name">{{
                country.name
              }}</span>
              <span class="app-auth__create-account__card__content__form__input--country__country-option__phone"
                >+{{ country.phone }}</span
              >
              <span class="app-auth__create-account__card__content__form__input--country__country-option__native">{{
                country.native
              }}</span>
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <mat-form-field appearance="standard" class="app-auth__create-account__card__content__form__input--phone">
          <fa-icon
            *ngIf="invalidCountrySelection"
            [icon]="['fas', 'phone-alt']"
            matPrefix
            class="app-auth__create-account__card__content__form__input__prefix"
            [ngClass]="{
              'app-text-theme-primary':
                !form_create_account.get('phone').touched || form_create_account.get('phone').valid,
              'app-text-theme-warn':
                form_create_account.get('phone').touched && form_create_account.get('phone').invalid
            }"
          ></fa-icon>
          <span
            *ngIf="!invalidCountrySelection"
            matPrefix
            class="app-auth__create-account__card__content__form__input__prefix app-auth__create-account__card__content__form__input__prefix--phone-code"
            [ngClass]="{
              'app-text-theme-primary':
                !form_create_account.get('phone').touched || form_create_account.get('phone').valid,
              'app-text-theme-warn':
                form_create_account.get('phone').touched && form_create_account.get('phone').invalid
            }"
            >+{{ form_create_account.get('country').value.phone }}</span
          >
          <mat-label>Phone</mat-label>
          <input type="tel" matInput formControlName="phone" [utilsDisableControl]="invalidCountrySelection" />
        </mat-form-field>

        <mat-form-field appearance="standard" class="app-auth__create-account__card__content__form__input--password">
          <fa-icon
            [icon]="['fas', 'asterisk']"
            matPrefix
            class="app-auth__create-account__card__content__form__input__prefix"
            [ngClass]="{
              'app-text-theme-primary':
                !form_create_account.get('password').touched || form_create_account.get('password').valid,
              'app-text-theme-warn':
                form_create_account.get('password').touched && form_create_account.get('password').invalid
            }"
          ></fa-icon>
          <mat-label>Password</mat-label>
          <input [type]="password_visible ? 'text' : 'password'" matInput formControlName="password" />
          <button
            mat-icon-button
            color="primary"
            matSuffix
            (click)="togglePasswordVisibility($event)"
            aria-label="Toggle password visibility"
          >
            <fa-icon
              [icon]="password_visible ? ['fas', 'eye-slash'] : ['fas', 'eye']"
              class="app-text-theme-primary"
            ></fa-icon>
          </button>
          <mat-error *ngIf="form_create_account.get('password').hasError('required')"
            ><fa-icon [icon]="['fas', 'exclamation-circle']"></fa-icon> Password is required</mat-error
          >
        </mat-form-field>
      </form>
    </mat-card-content>

    <mat-card-actions class="app-auth__create-account__card__actions">
      <a mat-button color="primary" [routerLink]="['/', 'login']" [queryParams]="{ application: application_key }"
        >Back to login</a
      >
      <button mat-flat-button color="primary" [disabled]="form_create_account.invalid">Create account</button>
    </mat-card-actions>
  </mat-card>
</section>
